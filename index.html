<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="EMA ISLA TENGLO" content="width=device-width, initial-scale=1.0">
<title> E.M.A - Isla Tenglo</title>

<!-- Fuentes e √≠conos -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />

<style>
body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(160deg, #001a33, #002b55, #001a33);
    color: #fff;
    margin: 0;
    padding: 0;
    line-height: 1.6;
    text-align: center;
}

/* ===== Men√∫ superior con logos ===== */
header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 50px;
    background: rgba(0,0,0,0.3);
}
header .logo { 
    height: 130px; 
    transition: transform 0.3s ease, filter 0.3s ease;
}
header .logo:hover {
    transform: scale(1.2);
    filter: drop-shadow(0 0 12px #00f0ff);
}

nav { display: flex; gap: 20px; align-items: center; }
nav a {
    color: #00f0ff;
    text-decoration: none;
    font-weight: 600;
    padding: 6px 12px;
    border-radius: 8px;
    transition: 0.3s;
}
nav a:hover { background: rgba(0,255,255,0.2); }

/* ===== Cabecera t√≠tulo ===== */
h1 {
    font-size: 2.5rem;
    font-weight: 700;
    background: linear-gradient(90deg, #00f0ff, #00ffae, #00f0ff);
    background-clip: text;
    -webkit-background-clip: text;
    color: transparent;
    animation: gradient 5s ease infinite;
}
@keyframes gradient { 0%{background-position:0% 50%;} 50%{background-position:100% 50%;} 100%{background-position:0% 50%;} }

/* ===== Hora ===== */
.time-container {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 50px;
    margin: 20px 0;
    font-size: 1.3rem;
    font-weight: 500;
}
.time-container i { color: #00f0ff; margin-right: 8px; }

/* ===== Tarjetas de datos ===== */
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:1.5rem; flex:1; margin:40px; }
.card {
  background: linear-gradient(145deg,#001a33,#002b55);
  padding:1rem;
  border-radius:20px;
  box-shadow: 0 5px 20px rgba(0,255,255,0.3);
  text-align:center;
  transition: all 0.3s ease;
}
.card:hover { transform: translateY(-5px); box-shadow: 0 12px 25px rgba(0,255,255,0.45); }
.label { font-weight:900; margin-bottom:0.5rem; display:flex; justify-content:center; align-items:center; gap:0.4rem; font-size:1.2rem; color:#00f0ff; }
.value { font-size:1.7rem; color: #00f0ff; }
#ultimaActualizacion { width:100%; text-align:center; font-size:1.0rem; margin-top:1rem; color: #00ffae; font-weight:700; }

/* ===== Rosa de vientos ===== */
.rose-container { display:flex; flex-direction:column; align-items:center; margin:20px 0; padding:10px; }

/* ===== Mapa ===== */
#map { height:400px; width:90%; margin:20px auto; border-radius:16px; border:2px solid #00ffae; }

/* ===== Footer ===== */
footer {
    margin-top: 40px;
    padding: 20px;
    font-size: 0.9rem;
    background: rgba(255,255,255,0.05);
    border-top: 1px solid rgba(255,255,255,0.2);
    text-align: center;
    color: #00f0ff;
}
</style>
</head>
<body>

<!-- Men√∫ superior con logos -->
<header>
    <img src="https://archive.org/download/imagen_mejorada_3D/ppp.png" alt="Logo 1" class="logo">
    <nav>
        <a href="#">Inicio</a>
        <a href="#">Estaciones</a>
        <a href="#">Mapa</a>
        <a href="#">Contacto</a>
    </nav>
    <img src="https://archive.org/download/imagen_mejorada_3D/LOGO%20METEOPMO.png" alt="Logo 2" class="logo">
</header>

<!-- Cabecera t√≠tulo -->
<h1>Estaci√≥n Meteorol√≥gica Autom√°tica Quinzona / Isla tenglo </h1>

<!-- Hora -->
<div class="time-container">
    <div><i class="fa-solid fa-clock"></i> Hora Local: <span id="horaLocal"></span></div>
    <div><i class="fa-solid fa-globe"></i> Hora UTC: <span id="horaUTC"></span></div>
</div>

<!-- Rosa de vientos -->
<div class="rose-container">
<svg id="windRose" viewBox="0 0 240 240" width="240" height="240">
    <defs>
      <radialGradient id="arrowGradient" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="#00f0ff" stop-opacity="1"/>
        <stop offset="100%" stop-color="#00ffae" stop-opacity="0.6"/>
      </radialGradient>
    </defs>
    <circle cx="120" cy="120" r="110" fill="rgba(0,255,255,0.1)"/>
    <circle cx="120" cy="120" r="90" fill="none" stroke="#00f0ff40" stroke-width="1.2"/>
    <circle cx="120" cy="120" r="70" fill="none" stroke="#00f0ff40" stroke-width="1.2"/>
    <g stroke="#ffffff50" stroke-width="1.5">
      <line x1="120" y1="10" x2="120" y2="24"/>
      <line x1="230" y1="120" x2="216" y2="120"/>
      <line x1="120" y1="230" x2="120" y2="216"/>
      <line x1="10" y1="120" x2="24" y2="120"/>
    </g>
    <g font-size="27" text-anchor="middle" fill="#00ffae" font-weight="700">
      <text x="120" y="26">N</text>
      <text x="214" y="124">E</text>
      <text x="120" y="220">S</text>
      <text x="26" y="124">W</text>
    </g>
    <g id="degreeNumbers"></g>
    <g id="arrow" transform="rotate(0 120 120)">
      <line x1="120" y1="120" x2="120" y2="40" stroke="url(#arrowGradient)" stroke-width="6" stroke-linecap="round"/>
      <polygon points="120,28 112,48 128,48" fill="url(#arrowGradient)"/>
      <line id="tail" x1="120" y1="120" x2="120" y2="120" stroke="url(#arrowGradient)" stroke-width="6" stroke-linecap="round" opacity=".6"/>
    </g>
    <circle id="intensityRing" cx="120" cy="120" r="40" fill="none" stroke="#00f0ff" stroke-width="4" stroke-linecap="round" stroke-opacity=".65"/>
    <text id="windSpeedText" x="120" y="128" text-anchor="middle" font-size="18" font-weight="600" fill="#00f0ff">-- nds</text>
</svg>
</div>

<!-- Tarjetas de datos -->
<div class="grid">
  <div class="card"><div class="label">üå¨ Viento</div><div id="viento" class="value">--</div></div>
  <div class="card"><div class="label">üí® Rachas</div><div id="Rachas" class="value">-- nds</div></div>
  <div class="card"><div class="label">üå° Temperatura</div><div id="temp_actual" class="value">-- ¬∞C</div></div>
  <div class="card"><div class="label">üíß Humedad</div><div id="humedad" class="value">-- %</div></div>
  <div class="card"><div class="label">üå´ Punto de roc√≠o</div><div id="rocio" class="value">-- ¬∞C</div></div>
  <div class="card"><div class="label">üß≠ Presi√≥n</div><div id="presion" class="value">-- hPa</div></div>
  <div class="card"><div class="label">üå° Temp. m√°xima</div><div id="temp_max" class="value">-- ¬∞C</div></div>
  <div class="card"><div class="label">üå° Temp. m√≠nima</div><div id="temp_min" class="value">-- ¬∞C</div></div>
  <div class="card"><div class="label">üåßÔ∏è Precipitaci√≥n</div><div id="Precipitacion" class="value">-- mm</div></div>
</div>
<div id="ultimaActualizacion">√öltima actualizaci√≥n: --</div>

<!-- Mapa -->
<div id="map"></div>

<!-- Footer -->
<footer>
    &copy; 2025 Estaci√≥n Meteorol√≥gica Chacao
</footer>

<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script>
/* ===== Hora ===== */
function actualizarHora() {
    const ahora = new Date();
    document.getElementById("horaLocal").textContent = ahora.toLocaleTimeString();
    document.getElementById("horaUTC").textContent = ahora.toLocaleTimeString('en-GB', { hour12: false, timeZone: 'UTC' });
}
setInterval(actualizarHora, 1000);
actualizarHora();

/* ===== Rosa de vientos ===== */
function convertirGradosAPuntoCardinal(grados){
  const direcciones = ['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSW','SW','WSW','W','WNW','NW','NNW'];
  return direcciones[Math.round(grados/22.5)%16];
}
function dibujarNumerosRosa(){
  const g=document.getElementById('degreeNumbers'); g.innerHTML='';
  const centerX=120, centerY=120, radius=100;
  for(let deg=0; deg<360; deg+=30){
    const rad=(deg-90)*Math.PI/180;
    const x=centerX+radius*Math.cos(rad);
    const y=centerY+radius*Math.sin(rad);
    const text=document.createElementNS("http://www.w3.org/2000/svg","text");
    text.setAttribute('x',x); text.setAttribute('y',y+4);
    text.setAttribute('text-anchor','middle'); text.setAttribute('fill','#00ffae');
    text.setAttribute('font-size','14'); text.setAttribute('font-weight','700');
    text.textContent=deg+'¬∞';
    g.appendChild(text);
  }
}
dibujarNumerosRosa();
function actualizarRosaAnimada(dir, spd){
  document.getElementById('arrow').setAttribute('transform',`rotate(${dir} 120 120)`);
  const k = Math.max(0, Math.min(spd/60, 1));
  document.getElementById('tail').setAttribute('y2', String(120 + 10 + (70 - 10) * k));
  document.getElementById('intensityRing').setAttribute('r', (30 + (95 - 30) * k).toFixed(1));
  document.getElementById('windSpeedText').textContent = `${spd} nds`;
}

/* ===== Cargar datos meteorol√≥gicos ===== */
async function cargarDatos(){
  try{
    const response = await fetch('https://corsproxy.io/?https://web.directemar.cl/met/jturno/estaciones/quinzona/realtime.txt');
    const lineas = (await response.text()).trim().split('\n');
    const datos = lineas[lineas.length-1].trim().split(/\s+/);
    const dir=parseFloat(datos[7]), vel=parseFloat(datos[5]), racha=parseFloat(datos[40]);

    document.getElementById('viento').textContent=`${dir}¬∞ (${convertirGradosAPuntoCardinal(dir)}) ${vel} nds`;
    document.getElementById('Rachas').textContent=`${racha} nds`;
    document.getElementById('temp_actual').textContent=`${datos[2]} ¬∞C`;
    document.getElementById('temp_max').textContent=`${datos[26]} ¬∞C`;
    document.getElementById('temp_min').textContent=`${datos[28]} ¬∞C`;
    document.getElementById('humedad').textContent=`${datos[3]} %`;
    document.getElementById('rocio').textContent=`${datos[4]} ¬∞C`;
    document.getElementById('presion').textContent=`${datos[10]} hPa`;
    document.getElementById('Precipitacion').textContent=`${datos[9]} mm`;

    const fecha=datos[0], hora=datos[1];
    document.getElementById('ultimaActualizacion').textContent = `√öltima actualizaci√≥n: ${fecha} ${hora}`;

    actualizarRosaAnimada(dir, vel);
  } catch(e){ console.error(e); }
}
cargarDatos();
setInterval(cargarDatos,5*60*1000);

L.map('map').setView([-41.4866,-72.9512],13)
  .addLayer(L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'))
  .addLayer(L.marker([-41.4866,-72.9512]).bindPopup('üìç Estaci√≥n Quinzona'));
</script>
</body>
</html>

