<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Estaci√≥n Quinzona PRO</title>
<link href="https://unpkg.com/phosphor-icons@1.4.2/src/css/phosphor.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />

<style>
:root {
  --primary-dark: #0a1a2f;
  --primary-light: #f0f8ff;
  --color blanco :white;
  --accent: #fdd835;
  --text-light: #ffffff;
  --text-dark: #0d1b2a;
  --rose-gradient: linear-gradient(135deg, #42a5f5, #1e88e5);
  --rose-gradient-light: linear-gradient(135deg, #80deea, #26c6da);
}

/* Body y fondo */
body {
  margin:0; padding:1.5rem;
  font-family:'Segoe UI', sans-serif;
  background-color: var(--primary-dark);
  color: var(--accent);
  transition: 0.5s ease;
}
body.modo-claro {
  background-color: var(--primary-light);
  color: var(--text-dark);
}

/* Contenedor general */
.container { max-width:1100px; margin:0 auto; display:flex; flex-wrap:wrap; gap:1.5rem; justify-content:center; }

/* Header */
.header { text-align:center; width:100%; margin-bottom:1rem; }
.header h1{ font-size:3rem; margin-bottom:0.2rem; }
.header h2{ font-size:1.5rem; font-weight:400; margin-bottom:0.5rem; }

/* Bot√≥n modo */
.toggle-btn {
  background:transparent; border:2px solid var(--accent);
  color: var(--accent); padding:0.5rem 1rem;
  font-weight:bold; border-radius:12px; cursor:pointer; transition:0.3s;
}
.toggle-btn:hover { background:var(--accent); color: var(--primary-dark); }
body.modo-claro .toggle-btn { border-color:#00796b; color:#00796b; }
body.modo-claro .toggle-btn:hover { background:#00796b; color:#ffffff; }

/* Rosa de vientos */
.rose-container { display:flex; flex-direction:column; align-items:center; margin-bottom:1rem; }
.rose-box {
  background: var(--rose-gradient); border-radius:20px; padding:20px;
  box-shadow:0 10px 25px rgba(0,0,0,0.3); display:flex; flex-direction:column; align-items:center;
  transition: all 0.3s ease;
}
body.modo-claro .rose-box { background: var(--rose-gradient-light); box-shadow:0 8px 20px rgba(0,0,0,0.15); }

.rose-legend {
  margin-top:12px; text-align:center;
  font-weight:1000; font-size:1.15rem;
  color:white;
}
body.modo-claro .rose-legend { color:#004d40; }

/* N√∫meros de grados */
#degreeNumbers text{ font-family:'Segoe UI', sans-serif; }

/* Tarjetas de datos modernas */
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:1.5rem; flex:1; }
.card {
  background: linear-gradient(145deg,#132743,#0a1a2f);
  padding:1.2rem 1rem; border-radius:20px;
  box-shadow: 0 5px 20px rgba(0,0,0,0.3);
  text-align:center; transition: all 0.3s ease;
}
.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 25px rgba(0,0,0,0.45);
}
.label { font-weight:700; margin-bottom:0.5rem; display:flex; justify-content:center; align-items:center; gap:0.4rem; font-size:0.95rem; }
.value { font-size:1.5rem; color: var(--text-light); }
body.modo-claro .card { background: linear-gradient(145deg,#e0f7fa,#b2ebf2); }
body.modo-claro .value { color: #004d40; }
body.modo-claro .label { color: #004d40; }

/* √öltima actualizaci√≥n */
#ultimaActualizacion { width:100%; text-align:center; font-size:0.95rem; margin-top:1rem; color:#ffeb3b; font-weight:600; }
body.modo-claro #ultimaActualizacion { color:#004d40; font-weight:700; }

/* Mapa */
#map { height:400px; width:100%; margin-top:1.5rem; border-radius:16px; border:2px solid var(--accent); }
body.modo-claro #map { border-color:#004d40; }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Estaci√≥n Meteorol√≥gica Quinzona</h1>
    <h2>(Isla Tenglo)</h2>
    <button class="toggle-btn" onclick="toggleModo()">üåû/üåô Modo Claro / Oscuro</button>
  </div>

  <!-- Rosa de vientos -->
  <div class="rose-container">
    <div class="rose-box">
      <svg id="windRose" viewBox="0 0 240 240" width="240" height="240" aria-label="Rosa de vientos">
        <circle cx="120" cy="120" r="110" fill="#1e88e5"/>
        <circle cx="120" cy="120" r="90" fill="none" stroke="#ffffff50" stroke-dasharray="3 6"/>
        <circle cx="120" cy="120" r="70" fill="none" stroke="#ffffff50" stroke-dasharray="3 6"/>
        <g stroke="#ffffff80" stroke-width="2">
          <line x1="120" y1="10" x2="120" y2="24"/>
          <line x1="230" y1="120" x2="216" y2="120"/>
          <line x1="120" y1="230" x2="120" y2="216"/>
          <line x1="10" y1="120" x2="24" y2="120"/>
        </g>
        <g font-size="14" text-anchor="middle" fill="#fff" font-weight="700">
          <text x="120" y="26">N</text>
          <text x="214" y="124">E</text>
          <text x="120" y="220">S</text>
          <text x="26" y="124">W</text>
        </g>
        <g id="degreeNumbers"></g>
        <g id="arrow" transform="rotate(0 120 120)">
          <line x1="120" y1="120" x2="120" y2="40" stroke="#fdd835" stroke-width="6" stroke-linecap="round"/>
          <polygon points="120,28 112,48 128,48" fill="#fdd835"/>
          <line id="tail" x1="120" y1="120" x2="120" y2="120" stroke="#fdd835" stroke-width="6" stroke-linecap="round" opacity=".6"/>
        </g>
        <circle id="intensityRing" cx="120" cy="120" r="40" fill="none" stroke="#ffeb3b" stroke-width="6" stroke-linecap="round" stroke-opacity=".65"/>
      </svg>
      <div class="rose-legend">
        <div>Direcci√≥n: <span id="dirText">--¬∞</span></div>
        <div>Velocidad: <span id="spdText">-- nds</span></div>
        <div>Rachas: <span id="gstText">-- nds</span></div>
      </div>
    </div>
  </div>

  <!-- Tarjetas de datos -->
  <div class="grid">
    <div class="card"><div class="label">üå°<i class="ph-thermometer"></i>Temperatura</div><div id="temperatura" class="value">-- ¬∞C</div></div>
    <div class="card"><div class="label">üíß<i class="ph-drop"></i>Humedad</div><div id="humedad" class="value">-- %</div></div>
    <div class="card"><div class="label">üå´<i class="ph-cloud-rain"></i>Punto de roc√≠o</div><div id="rocio" class="value">-- ¬∞C</div></div>
    <div class="card"><div class="label">üß≠<i class="ph-gauge"></i>Presi√≥n</div><div id="presion" class="value">-- hPa</div></div>
    <div class="card"><div class="label">üå¨<i class="ph-wind"></i>Viento</div><div id="viento" class="value">--</div></div>
    <div class="card"><div class="label">üí®<i class="ph-arrow-bend-up-right"></i>Rachas</div><div id="Rachas" class="value">-- nds</div></div>
    <div class="card"><div class="label">üåßÔ∏è<i class="ph-Precipitacion"></i>Precipitaci√≥n</div><div id="Precipitaci√≥n" class="value">-- mm</div></div>
  </div>

  <!-- √öltima actualizaci√≥n -->
  <div id="ultimaActualizacion">√öltima actualizaci√≥n: --</div>

  <!-- Mapa -->
  <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script>
function convertirGradosAPuntoCardinal(grados){
  const direcciones = ['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSW','SW','WSW','W','WNW','NW','NNW'];
  const indice = Math.round(grados/22.5)%16;
  return direcciones[indice];
}

function dibujarNumerosRosa(){
  const g = document.getElementById('degreeNumbers'); g.innerHTML='';
  const centerX=120, centerY=120, radius=100;
  for(let deg=0; deg<360; deg+=30){
    const rad=(deg-90)*Math.PI/180;
    const x=centerX+radius*Math.cos(rad);
    const y=centerY+radius*Math.sin(rad);
    const text=document.createElementNS("http://www.w3.org/2000/svg","text");
    text.setAttribute('x',x); text.setAttribute('y',y+4);
    text.setAttribute('text-anchor','middle'); text.setAttribute('fill','#ffeb3b');
    text.setAttribute('font-size','12'); text.setAttribute('font-weight','700'); text.textContent=deg+'¬∞';
    g.appendChild(text);
  }
}
dibujarNumerosRosa();

function actualizarRosaAnimada(dirGrados, spdNudos, gustNudos){
  const arrow=document.getElementById('arrow');
  const tail=document.getElementById('tail');
  const ring=document.getElementById('intensityRing');
  arrow.style.transition='transform 1.5s ease';
  arrow.setAttribute('transform',`rotate(${dirGrados} 120 120)`);
  const k=Math.max(0,Math.min(spdNudos/60,1));
  const tailLen=10+(70-10)*k;
  tail.setAttribute('x1','120'); tail.setAttribute('y1','120');
  tail.setAttribute('x2','120'); tail.setAttribute('y2',String(120+tailLen));
  const r=30+(95-30)*k; ring.setAttribute('r',r.toFixed(1));
  document.getElementById('dirText').textContent=`${dirGrados.toFixed(0)}¬∞ (${convertirGradosAPuntoCardinal(dirGrados)})`;
  document.getElementById('spdText').textContent=`${spdNudos} nds`;
  document.getElementById('gstText').textContent=`${gustNudos} nds`;
}

async function cargarDatos(){
  try{
    const response = await fetch('https://corsproxy.io/?https://web.directemar.cl/met/jturno/estaciones/quinzona/realtime.txt');
    const texto = await response.text();
    const lineas = texto.trim().split('\n');
    const ultimaLinea = lineas[lineas.length-1];
    const datos = ultimaLinea.trim().split(/\s+/);
    const direccionGrados=parseFloat(datos[7]);
    const velocidadNudos=parseFloat(datos[5]);
    const rachasNudos=parseFloat(datos[40]);

    document.getElementById('temperatura').textContent=`${datos[2]} ¬∞C`;
    document.getElementById('humedad').textContent=`${datos[3]} %`;
    document.getElementById('rocio').textContent=`${datos[4]} ¬∞C`;
    document.getElementById('presion').textContent=`${datos[10]} hPa`;
    document.getElementById('viento').textContent=`${direccionGrados}¬∞ (${convertirGradosAPuntoCardinal(direccionGrados)}) ${velocidadNudos} nds`;
    document.getElementById('Rachas').textContent=`${rachasNudos} nds`;
    document.getElementById('Precipitaci√≥n').textContent=`${datos[9]} mm`;
    actualizarRosaAnimada(direccionGrados, velocidadNudos, rachasNudos);

    const ahora=new Date();
    document.getElementById('ultimaActualizacion').textContent=
      `√öltima actualizaci√≥n: ${ahora.toLocaleDateString()} ${ahora.toLocaleTimeString()}`;
  } catch(e){ console.error(e); }
}
cargarDatos(); setInterval(cargarDatos,5*60*1000);

const map=L.map('map').setView([-41.4866,-72.9512],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap contributors'}).addTo(map);
L.marker([-41.4866,-72.9512]).addTo(map).bindPopup('üìç Estaci√≥n Quinzona').openPopup();

function toggleModo(){ document.body.classList.toggle('modo-claro'); }

// Fondo din√°mico seg√∫n hora
const hora=new Date().getHours();
if(hora>=6 && hora<18){ document.body.classList.add('modo-claro'); } 
</script>
</body>
</html>
